// Sistema de traducciones para MP Global Corp Miniapp
const translations = {
    es: {
        // Header
        'app_title': 'MP Global Corp¬Æ',
        'app_tagline': 'Premium Cannabis Products',
        'cart': 'Carrito',
        'menu': 'Men√∫',
        'language_changed': 'Idioma cambiado a',

        // Navigation
        'all_products': 'Todos',
        'moroccan_hash': 'üá≤üá¶ Moroccan',
        'spanish_flower': 'üá™üá∏ Spanish',
        'cali_flower': 'üá∫üá∏ California',
        'extractions': 'üî¨ Extractions',
        'varios': 'üì¶ Varios',
        'search_placeholder': 'Buscar productos...',

        // Product Modal
        'product_details': 'Detalles del Producto',
        'price_options': 'Opciones de Precio',
        'add_to_cart': 'Agregar al Pedido',
        'add': 'Agregar',
        'for': 'por',
        'available': 'Disponible',
        'unavailable': 'No Disponible',
        'description': 'Descripci√≥n',
        'stock': 'Stock',

        // Cart Modal
        'my_order': 'Mi Pedido',
        'cart_empty': 'Tu carrito est√° vac√≠o',
        'clear_cart': 'Limpiar',
        'proceed_order': 'Proceder al Pedido',
        'total': 'Total',
        'quantity': 'Cantidad',
        'products': 'productos',
        'per_unit': 'c/u',
        'per_100': 'cada 100@',
        'remove_item': 'Eliminar',

        // Order Modal
        'order_form': 'Formulario de Pedido',
        'order_details': 'Detalles del Pedido',
        'customer_info': 'Informaci√≥n del Cliente',
        'name': 'Nombre',
        'full_name': 'Nombre Completo',
        'phone': 'Tel√©fono',
        'address': 'Direcci√≥n',
        'city': 'Ciudad',
        'province': 'Provincia',
        'postal_code': 'C√≥digo Postal',
        'order_content': 'Contenido del Pedido',
        'username': 'Nombre de Usuario',
        'comments': 'Comentarios',
        'comments_suggestions': 'Comentarios/Sugerencias',
        'payment_method': 'M√©todo de Pago',
        'select_payment_method': 'Seleccionar m√©todo',
        'crypto': 'Criptomonedas',
        'bank_transfer': 'Transferencia Bancaria',
        'other': 'Otro',
        'cancel': 'Cancelar',
        'submit_order': 'Enviar Pedido',
        'sending': 'Enviando...',

        // Success Modal
        'telegram_opened': '¬°Chat de Telegram Abierto!',
        'telegram_message': 'Se ha abierto un chat con @grlltdc con los detalles de tu pedido. Completa tu pedido all√≠ para finalizar la compra.',
        'telegram_note': 'Nota: Si no se abri√≥ autom√°ticamente, busca @grlltdc en Telegram.',
        'note_label': 'Nota:',
        'close': 'Cerrar',

        // Security Modal
        'security_privacy': 'Seguridad y Privacidad',
        'data_security': 'Seguridad de Datos',
        'privacy': 'Privacidad',
        'legal_compliance': 'Cumplimiento Legal',
        'mobile_security': 'Seguridad M√≥vil',
        'clear_all_data': 'Limpiar Todos los Datos',
        'confirm_clear_all_data': '¬øEst√°s seguro de que quieres eliminar todos los datos locales? Esto incluye tu carrito y preferencias.',

        // Footer
        'copyright': '¬© 2025 MP Global Corp. Todos los derechos reservados.',
        'adult_only': 'Productos de cannabis premium para adultos.',
        'security_privacy_link': 'Seguridad y Privacidad',
        'information': 'Informaci√≥n',
        'loading_information': 'Cargando informaci√≥n...',

        // Toast Messages
        'product_added': 'Producto agregado al carrito',
        'cart_cleared': 'Carrito limpiado',
        'cart_empty_error': 'Tu carrito est√° vac√≠o',
        'telegram_opened_success': '¬°Chat de Telegram abierto!',
        'telegram_error': 'Error abriendo chat de Telegram',
        'data_cleared': 'Todos los datos han sido eliminados',
        'data_clear_error': 'Error al eliminar los datos',
        'form_errors': 'Por favor, corrige los errores en el formulario',
        'error_sending_order': 'Error enviando el pedido. Int√©ntalo de nuevo.',

        // General UI
        'loading_catalog': 'Cargando cat√°logo...',
        'error_loading_catalog': 'Error cargando productos',
        'no_products_found': 'No se encontraron productos',
        'try_different_terms': 'Intenta con otros t√©rminos de b√∫squeda',

        // Image Zoom
        'image_zoom': 'Imagen del Producto',
        'zoom_in': 'Acercar',
        'zoom_out': 'Alejar',
        'zoom_reset': 'Restablecer',
        'zoom_rotate': 'Rotar',
        
        // Navigation
        'back': 'Volver'
    },

    en: {
        // Header
        'app_title': 'MP Global Corp¬Æ',
        'app_tagline': 'Premium Cannabis Products',
        'cart': 'Cart',
        'menu': 'Menu',
        'language_changed': 'Language changed to',

        // Navigation
        'all_products': 'All',
        'moroccan_hash': 'üá≤üá¶ Moroccan',
        'spanish_flower': 'üá™üá∏ Spanish',
        'cali_flower': 'üá∫üá∏ California',
        'extractions': 'üî¨ Extractions',
        'varios': 'üì¶ Various',
        'search_placeholder': 'Search products...',

        // Product Modal
        'product_details': 'Product Details',
        'price_options': 'Price Options',
        'add_to_cart': 'Add to Order',
        'add': 'Add',
        'for': 'for',
        'available': 'Available',
        'unavailable': 'Unavailable',
        'description': 'Description',
        'stock': 'Stock',

        // Cart Modal
        'my_order': 'My Order',
        'cart_empty': 'Your cart is empty',
        'clear_cart': 'Clear',
        'proceed_order': 'Proceed to Order',
        'total': 'Total',
        'quantity': 'Quantity',
        'products': 'products',
        'per_unit': 'each',
        'per_100': 'per 100@',
        'remove_item': 'Remove',

        // Order Modal
        'order_form': 'Order Form',
        'order_details': 'Order Details',
        'customer_info': 'Customer Information',
        'name': 'Name',
        'full_name': 'Full Name',
        'phone': 'Phone',
        'address': 'Address',
        'city': 'City',
        'province': 'Province',
        'postal_code': 'Postal Code',
        'order_content': 'Order Content',
        'username': 'Username',
        'comments': 'Comments',
        'comments_suggestions': 'Comments/Suggestions',
        'payment_method': 'Payment Method',
        'select_payment_method': 'Select method',
        'crypto': 'Cryptocurrencies',
        'bank_transfer': 'Bank Transfer',
        'other': 'Other',
        'cancel': 'Cancel',
        'submit_order': 'Submit Order',
        'sending': 'Sending...',

        // Success Modal
        'telegram_opened': 'Telegram Chat Opened!',
        'telegram_message': 'A chat with @grlltdc has been opened with your order details. Complete your order there to finalize the purchase.',
        'telegram_note': 'Note: If it didn\'t open automatically, search for @grlltdc on Telegram.',
        'note_label': 'Note:',
        'close': 'Close',

        // Security Modal
        'security_privacy': 'Security & Privacy',
        'data_security': 'Data Security',
        'privacy': 'Privacy',
        'legal_compliance': 'Legal Compliance',
        'mobile_security': 'Mobile Security',
        'clear_all_data': 'Clear All Data',
        'confirm_clear_all_data': 'Are you sure you want to delete all local data? This includes your cart and preferences.',

        // Footer
        'copyright': '¬© 2025 MP Global Corp. All rights reserved.',
        'adult_only': 'Premium cannabis products for adults.',
        'security_privacy_link': 'Security & Privacy',
        'information': 'Information',
        'loading_information': 'Loading information...',

        // Toast Messages
        'product_added': 'Product added to cart',
        'cart_cleared': 'Cart cleared',
        'cart_empty_error': 'Your cart is empty',
        'telegram_opened_success': 'Telegram chat opened!',
        'telegram_error': 'Error opening Telegram chat',
        'data_cleared': 'All data has been cleared',
        'data_clear_error': 'Error clearing data',
        'form_errors': 'Please correct the errors in the form',
        'error_sending_order': 'Error sending the order. Please try again.',

        // General UI
        'loading_catalog': 'Loading catalog...',
        'error_loading_catalog': 'Error loading products',
        'no_products_found': 'No products found',
        'try_different_terms': 'Try different search terms',

        // Image Zoom
        'image_zoom': 'Product Image',
        'zoom_in': 'Zoom In',
        'zoom_out': 'Zoom Out',
        'zoom_reset': 'Reset',
        'zoom_rotate': 'Rotate',
        
        // Navigation
        'back': 'Back'
    },

    fr: {
        // Header
        'app_title': 'MP Global Corp¬Æ',
        'app_tagline': 'Produits Cannabis Premium',
        'cart': 'Panier',
        'menu': 'Menu',
        'language_changed': 'Langue chang√©e en',

        // Navigation
        'all_products': 'Tous',
        'moroccan_hash': 'üá≤üá¶ Marocain',
        'spanish_flower': 'üá™üá∏ Espagnol',
        'cali_flower': 'üá∫üá∏ Californie',
        'extractions': 'üî¨ Extractions',
        'varios': 'üì¶ Divers',
        'search_placeholder': 'Rechercher des produits...',

        // Product Modal
        'product_details': 'D√©tails du Produit',
        'price_options': 'Options de Prix',
        'add_to_cart': 'Ajouter √† la Commande',
        'add': 'Ajouter',
        'for': 'pour',
        'available': 'Disponible',
        'unavailable': 'Indisponible',
        'description': 'Description',
        'stock': 'Stock',

        // Cart Modal
        'my_order': 'Ma Commande',
        'cart_empty': 'Votre panier est vide',
        'clear_cart': 'Vider',
        'proceed_order': 'Proc√©der √† la Commande',
        'total': 'Total',
        'quantity': 'Quantit√©',
        'products': 'produits',
        'per_unit': 'pi√®ce',
        'per_100': 'par 100@',
        'remove_item': 'Supprimer',

        // Order Modal
        'order_form': 'Formulaire de Commande',
        'order_details': 'D√©tails de la Commande',
        'customer_info': 'Informations Client',
        'name': 'Nom',
        'full_name': 'Nom Complet',
        'phone': 'T√©l√©phone',
        'address': 'Adresse',
        'city': 'Ville',
        'province': 'Province',
        'postal_code': 'Code Postal',
        'order_content': 'Contenu de la Commande',
        'username': 'Nom d\'utilisateur',
        'comments': 'Commentaires',
        'comments_suggestions': 'Commentaires/Suggestions',
        'payment_method': 'M√©thode de Paiement',
        'select_payment_method': 'S√©lectionner une m√©thode',
        'crypto': 'Cryptomonnaies',
        'bank_transfer': 'Virement Bancaire',
        'other': 'Autre',
        'cancel': 'Annuler',
        'submit_order': 'Envoyer la Commande',
        'sending': 'Envoi...',

        // Success Modal
        'telegram_opened': 'Chat Telegram Ouvert!',
        'telegram_message': 'Un chat avec @grlltdc a √©t√© ouvert avec les d√©tails de votre commande. Compl√©tez votre commande l√†-bas pour finaliser l\'achat.',
        'telegram_note': 'Note: Si cela ne s\'est pas ouvert automatiquement, recherchez @grlltdc sur Telegram.',
        'note_label': 'Note :',
        'close': 'Fermer',

        // Security Modal
        'security_privacy': 'S√©curit√© et Confidentialit√©',
        'data_security': 'S√©curit√© des Donn√©es',
        'privacy': 'Confidentialit√©',
        'legal_compliance': 'Conformit√© L√©gale',
        'mobile_security': 'S√©curit√© Mobile',
        'clear_all_data': 'Effacer Toutes les Donn√©es',
        'confirm_clear_all_data': '√ätes-vous s√ªr de vouloir supprimer toutes les donn√©es locales ? Ceci inclut votre panier et vos pr√©f√©rences.',

        // Footer
        'copyright': '¬© 2025 MP Global Corp. Tous droits r√©serv√©s.',
        'adult_only': 'Produits cannabis premium pour adultes.',
        'security_privacy_link': 'S√©curit√© et Confidentialit√©',
        'information': 'Information',
        'loading_information': 'Chargement des informations...',

        // Toast Messages
        'product_added': 'Produit ajout√© au panier',
        'cart_cleared': 'Panier vid√©',
        'cart_empty_error': 'Votre panier est vide',
        'telegram_opened_success': 'Chat Telegram ouvert!',
        'telegram_error': 'Erreur lors de l\'ouverture du chat Telegram',
        'data_cleared': 'Toutes les donn√©es ont √©t√© effac√©es',
        'data_clear_error': 'Erreur lors de l\'effacement des donn√©es',
        'form_errors': 'Veuillez corriger les erreurs du formulaire',
        'error_sending_order': 'Erreur lors de l\'envoi de la commande. Veuillez r√©essayer.',

        // General UI
        'loading_catalog': 'Chargement du catalogue...',
        'error_loading_catalog': 'Erreur de chargement des produits',
        'no_products_found': 'Aucun produit trouv√©',
        'try_different_terms': 'Essayez d\'autres termes de recherche',

        // Image Zoom
        'image_zoom': 'Image du Produit',
        'zoom_in': 'Zoomer',
        'zoom_out': 'D√©zoomer',
        'zoom_reset': 'R√©initialiser',
        'zoom_rotate': 'Tourner',
        
        // Navigation
        'back': 'Retour'
    }
};

// Clase para manejar las traducciones
class TranslationManager {
    constructor() {
        this.currentLanguage = this.getStoredLanguage() || this.detectBrowserLanguage() || 'es';
        this.translations = translations;
        this.applyHtmlLang();
    }

    getStoredLanguage() {
        return localStorage.getItem('mp_language') || 'es';
    }

    detectBrowserLanguage() {
        const lang = (navigator.language || navigator.userLanguage || 'es').slice(0, 2);
        if (this.translations[lang]) return lang;
        return 'es';
    }

    setLanguage(language) {
        if (this.translations[language]) {
            this.currentLanguage = language;
            localStorage.setItem('mp_language', language);
            this.applyHtmlLang();
            this.updateUI();
        }
    }

    t(key) {
        return this.translations[this.currentLanguage][key] || key;
    }

    updateUI() {
        // Actualizar todos los elementos con data-i18n
        document.querySelectorAll('[data-i18n]').forEach(element => {
            const key = element.getAttribute('data-i18n');
            const translation = this.t(key);

            if (element.tagName === 'INPUT' && element.type === 'text') {
                element.placeholder = translation;
            } else if (element.tagName === 'TEXTAREA') {
                element.placeholder = translation;
            } else {
                element.textContent = translation;
            }
        });

        // Actualizar t√≠tulos de atributos
        document.querySelectorAll('[data-i18n-title]').forEach(element => {
            const key = element.getAttribute('data-i18n-title');
            element.title = this.t(key);
        });
    }

    getAvailableLanguages() {
        return Object.keys(this.translations).map(code => ({
            code,
            name: this.getLanguageName(code)
        }));
    }

    getLanguageName(code) {
        const names = {
            'es': 'Espa√±ol',
            'en': 'English',
            'fr': 'Fran√ßais'
        };
        return names[code] || code;
    }

    getLocale() {
        const locales = {
            'es': 'es-ES',
            'en': 'en-US',
            'fr': 'fr-FR'
        };
        return locales[this.currentLanguage] || 'es-ES';
    }

    applyHtmlLang() {
        try {
            document.documentElement.setAttribute('lang', this.currentLanguage);
        } catch (_) {}
    }
}

// Exportar para uso global
window.TranslationManager = TranslationManager;
window.translations = translations;
